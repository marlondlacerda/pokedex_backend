/// <reference types="node" />
import * as net from 'net';
import { TestSuiteEvent, TestEvent, TestSuiteInfo, TestRunFinishedEvent } from 'vscode-test-adapter-api';
export declare type EnvVars = {
    [envVar: string]: string | null;
};
/**
 * This object contains all arguments to the worker script except for the `NetworkOptions`
 */
export interface WorkerArgs {
    /** what the worker should do */
    action: 'loadTests' | 'runTests';
    /** the working directory */
    cwd: string;
    /** the absolute paths of all files containing tests */
    testFiles: string[];
    /** if `action` is `'runTests'`, this contains the IDs of all tests that should be run */
    tests?: string[];
    /** environment variables to be set in the worker process */
    env: EnvVars;
    /** the absolute path to the mocha _package_ */
    mochaPath?: string;
    /** options to be passed to mocha */
    mochaOpts: MochaOpts;
    /** if `action` is `'loadTests'`, this flag determines if the worker should apply a monkey patch
     * to mocha that is necessary to detect the source locations of dynamically generated tests. */
    monkeyPatch?: boolean;
    /** Ignore Mocha's idea of which file a test is located in. This is necessary for the monkey patch
     * to find the correct test locations when a suite includes tests from other files. */
    multiFileSuites?: boolean;
    /** this flag tells the worker if the diagnostic log is enabled */
    logEnabled: boolean;
    /** the absolute path to the worker script */
    workerScript?: string;
    /** if the tests should be run in the debugger, this contains the port that the debugger should
     * use. Otherwise it is undefined. */
    debuggerPort?: number;
    /** this flag tells the worker if it should use Mocha's experimental ESM module loader if it is available */
    esmLoader: boolean;
}
/**
 * The mocha options supported by the worker script
 */
export interface MochaOpts {
    ui: string;
    timeout: number;
    retries: number;
    requires: string[];
    delay: boolean;
    fullTrace: boolean;
    exit: boolean;
    asyncOnly: boolean;
    parallel: boolean;
    jobs?: number;
}
/**
 * This object is sent by the worker script if loading the tests failed,
 * the `errorMessage` will be displayed in the Test Explorer UI
 */
export interface ErrorInfo {
    type: 'error';
    errorMessage: string;
}
/**
 * This object can be passed (JSON-encoded) as the first command-line argument to the worker process
 * to make it communicate via TCP/IP instead of node's IPC channel.
 */
export interface NetworkOptions {
    /** whether the worker should act as a TCP client or server */
    role: 'client' | 'server';
    /** the TCP port that the worker should use */
    port: number;
    /**
     * If `role` is `'client'`, this specifies the host that the worker should connect to,
     * the default is `localhost`.
     * If `role` is `'server'`, this specifies the address on which the worker will listen.
     */
    host?: string;
}
/**
 * Convert all paths in a `WorkerArgs` object using the given `convertPath` function
 */
export declare function convertWorkerArgs(workerArgs: WorkerArgs, convertPath: (path: string) => string): WorkerArgs;
/**
 * This is a typed version of `readMessages` for receiving the worker protocol messages when loading the tests
 */
export declare function receiveTestLoadMessages(socket: net.Socket, handler: (msg: string | TestSuiteInfo | ErrorInfo | null) => void): void;
/**
 * This is a typed version of `readMessages` for receiving the worker protocol messages when running the tests
 */
export declare function receiveTestRunMessages(socket: net.Socket, handler: (msg: string | TestSuiteEvent | TestEvent) => void): void;
/**
 * Convert all paths in worker protocol messages when loading the tests using the given `convertPath` function
 */
export declare function convertTestLoadMessage(msg: string | TestSuiteInfo | ErrorInfo | null, convertPath: (path: string) => string): string | TestSuiteInfo | ErrorInfo | null;
/**
 * Convert all paths in worker protocol messages when running the tests using the given `convertPath` function
 */
export declare function convertTestRunMessage(msg: string | TestSuiteEvent | TestEvent | TestRunFinishedEvent, convertPath: (path: string) => string): string | TestSuiteEvent | TestEvent | TestRunFinishedEvent;
